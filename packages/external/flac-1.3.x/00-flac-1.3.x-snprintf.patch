diff -u flac-1.3.0/src/libFLAC/metadata_iterators.c flac-1.3.x/src/libFLAC/metadata_iterators.c
--- flac-1.3.0/src/libFLAC/metadata_iterators.c
+++ flac-1.3.x/src/libFLAC/metadata_iterators.c
@@ -3235,13 +3235,16 @@ static int
 local_snprintf(char *str, size_t size, const char *fmt, ...)
 {
 	va_list va;
-	int rc ;
+	int rc;
 
 	va_start (va, fmt);
 
-#ifdef _MSC_VER
-	rc = vsnprintf_s (str, size, _TRUNCATE, fmt, va);
-	rc = (rc > 0) ? rc : (size == 0 ? 1024 : size * 2);
+#ifdef _WIN32
+	rc = _vsnprintf (str, size, fmt, va);
+	if (size != 0) {
+		if (rc < 0) rc = (int)size;
+		if ((size_t)rc >= size) str[size - 1] = '\0';
+	}
 #else
 	rc = vsnprintf (str, size, fmt, va);
 #endif
