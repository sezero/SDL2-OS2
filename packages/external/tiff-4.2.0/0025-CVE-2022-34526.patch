From 275735d0354e39c0ac1dc3c0db2120d6f31d1990 Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@spatialys.com>
Date: Mon, 27 Jun 2022 16:09:43 +0200
Subject: [PATCH] _TIFFCheckFieldIsValidForCodec(): return FALSE when passed a
 codec-specific tag and the codec is not configured (fixes #433)

This avoids crashes when querying such tags
---
 libtiff/tif_dirinfo.c | 3 +++
 1 file changed, 3 insertions(+)

Index: tiff-4.2.0/libtiff/tif_dirinfo.c
===================================================================
--- tiff-4.2.0.orig/libtiff/tif_dirinfo.c
+++ tiff-4.2.0/libtiff/tif_dirinfo.c
@@ -1157,6 +1157,9 @@ _TIFFCheckFieldIsValidForCodec(TIFF *tif
 	    default:
 		return 1;
 	}
+	if( !TIFFIsCODECConfigured(tif->tif_dir.td_compression) ) {
+		return 0;
+	}
 	/* Check if codec specific tags are allowed for the current
 	 * compression scheme (codec) */
 	switch (tif->tif_dir.td_compression) {
