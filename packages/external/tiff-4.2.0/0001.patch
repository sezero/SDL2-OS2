From efce8cf80ae935084e86b395bc215b73aa482c24 Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@spatialys.com>
Date: Sun, 6 Feb 2022 13:08:38 +0100
Subject: [PATCH 01/10] TIFFFetchStripThing(): avoid calling memcpy() with a null source pointer and size of zero (fixes #362)

Backported from commit eecb0712f4c3a5b449f70c57988260a667ddbdef
---
 libtiff/tif_dirread.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/libtiff/tif_dirread.c b/libtiff/tif_dirread.c
index ba127ca..b6a7d59 100644
--- a/libtiff/tif_dirread.c
+++ b/libtiff/tif_dirread.c
@@ -5765,7 +5765,8 @@ TIFFFetchStripThing(TIFF* tif, TIFFDirEntry* dir, uint32 nstrips, uint64** lpp)
 			_TIFFfree(data);
 			return(0);
 		}
-                _TIFFmemcpy(resizeddata,data,(uint32)dir->tdir_count*sizeof(uint64));
+                if (dir->tdir_count)
+                    _TIFFmemcpy(resizeddata,data,(uint32)dir->tdir_count*sizeof(uint64));
                 _TIFFmemset(resizeddata+(uint32)dir->tdir_count,0,(nstrips-(uint32)dir->tdir_count)*sizeof(uint64));
 		_TIFFfree(data);
 		data=resizeddata;
-- 
1.7.1

